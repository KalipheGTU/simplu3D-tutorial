<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="MBrasebin">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Topologique - SimPLU3D tutorial</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Topologique";
    var mkdocs_page_input_path = "rules/topologique.md";
    var mkdocs_page_url = "/rules/topologique/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> SimPLU3D tutorial</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../about/">About</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../bibliographie/">Bibliographie</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../development/">Development</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../export/">Export</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Begin</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../begin/first_simulation/">First simulation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../begin/installation/">Installation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../begin/intro/">Intro</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Envgeo</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../envgeo/integration-test/">Integration test</a>
                </li>
                <li class="">
                    
    <a class="" href="../../envgeo/integration/">Integration</a>
                </li>
                <li class="">
                    
    <a class="" href="../../envgeo/intro/">Intro</a>
                </li>
                <li class="">
                    
    <a class="" href="../../envgeo/modelgeo/">Modelgeo</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Generator</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../generator/custom-generator/">Custom generator</a>
                </li>
                <li class="">
                    
    <a class="" href="../../generator/custom-optimisation/">Custom optimisation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../generator/custom-shape/">Custom shape</a>
                </li>
                <li class="">
                    
    <a class="" href="../../generator/intro/">Intro</a>
                </li>
                <li class="">
                    
    <a class="" href="../../generator/principe/">Principe</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Openmole</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../openmole/intro/">Intro</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Principe</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../principe/intro/">Intro</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Rules</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../formats/">Formats</a>
                </li>
                <li class="">
                    
    <a class="" href="../intro/">Intro</a>
                </li>
                <li class="">
                    
    <a class="" href="../predicate/">Predicate</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Topologique</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#prise-en-compte-de-regles-topologiques">Prise en compte de règles topologiques</a></li>
    

    <li class="toctree-l3"><a href="#strategie-1-transformation-en-contrainte-geometrique">Stratégie 1 : transformation en contrainte géométrique</a></li>
    

    <li class="toctree-l3"><a href="#strategie-2-generation-de-boites-alignees">Stratégie 2 :  génération de boîtes alignées</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#executable-pour-la-generation-de-boites-alignees">Exécutable pour la génération de boîtes alignées</a></li>
        
            <li><a class="toctree-l4" href="#definition-de-loptimiseur">Définition de l'optimiseur</a></li>
        
        </ul>
    

    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Visitor</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../visitor/intro/">Intro</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">SimPLU3D tutorial</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Rules &raquo;</li>
        
      
    
    <li>Topologique</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/SimPLU3D/simplu3D-tutorial/rules/topologique.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <hr />
<h1 id="prise-en-compte-de-regles-topologiques">Prise en compte de règles topologiques<a class="headerlink" href="#prise-en-compte-de-regles-topologiques" title="Permanent link"></a></h1>
<p>Le fonctionnement de base de SimPLU3D qui consiste à tirer des valeurs aléatoires dans un espace continu rend difficile l'application de contraintes topologiques. Si on prend l'exemple de l'alignement aux limites séparatives donnant sur une route (cf image ci-dessous), il est totalement improbable que SimPLU3D effectue le tirage d'une boîte respectant cet alignement (cela revient à tirer exactement le bonne valeur de x,y,w et θ). Deux stratégies sont possibles pour utiliser de telles règles.</p>
<p><img alt="Illustration de la contrainte d'alignement" src="../img/alignement.png" /></p>
<h1 id="strategie-1-transformation-en-contrainte-geometrique">Stratégie 1 : transformation en contrainte géométrique<a class="headerlink" href="#strategie-1-transformation-en-contrainte-geometrique" title="Permanent link"></a></h1>
<p>La stratégie naïve consisterait à transformer la contrainte topologique en contrainte géométrique. Par exemple, de vérifier si l'un des côtés de la boîte est inclus dans un buffer de petite taille autour de la limite donnant sur la voirie.</p>
<p>Cela rend probable la proposition de boîtes par le système respectant cette règle, mais comme cette probabilité reste relativement faible, il peut être nécessaire d'augmenter le nombre d'itérations afin d'atteindre un résultat optimisé.</p>
<h1 id="strategie-2-generation-de-boites-alignees">Stratégie 2 :  génération de boîtes alignées<a class="headerlink" href="#strategie-2-generation-de-boites-alignees" title="Permanent link"></a></h1>
<p>La seconde stratégie consiste à non plus générer des boîtes libres, mais des boîtes directement alignées sur la limite considérée. Il s'agit ainsi de définir un nouveau générateur de forme (comme décrit dans la section <a href="../../generator/custom-shape/"><strong>Générateur de formes - Générer d'autres types de formes</strong></a>).</p>
<p>Dans ce cas, la géométrie paramétrique utilisée est non plus une boîte à 6 dimensions ( <strong>b</strong> = (<strong>x</strong>, <strong>y</strong>, <strong>l</strong>, <strong>w</strong>, <strong>h</strong>, <strong>θ</strong>)), mais un boîte parallèle à 4 dimensions ( <strong>bp</strong> = (<strong>x</strong>, <strong>y</strong>, <strong>l</strong>, <strong>h</strong>), en considérant que l'orientation et la largeur sont imposées par les coordonnées du centre de l'objet.</p>
<h2 id="executable-pour-la-generation-de-boites-alignees">Exécutable pour la génération de boîtes alignées<a class="headerlink" href="#executable-pour-la-generation-de-boites-alignees" title="Permanent link"></a></h2>
<p>Dans le projet SimPLU3D-tutorial, une classe a été ajoutée sur la base de l'exemple de base pour effectuer des simulation avec des boîtes qui seraient alignées à la limite donnant sur la voirie. Il s'agit de la classe : <em>fr.ign.simplu3d.topologicRule.ParallelSimulator</em></p>
<pre><code class="JAVA">  // NEW HERE THE PARALELLE OPTIMOIZER IS USED
  ParallelCuboidOptimizer oCB = new ParallelCuboidOptimizer();

  // IT REQUIRES AS INPUT THE GEOMETRY WHERE THE CUBOIDS HAVE TO BE ALIGNED
  IGeometry[] limits = createRoadLimits(bPU);

  // Run of the optimisation on a parcel with the predicate
  GraphConfiguration&lt;Cuboid&gt; cc = oCB.process(Random.random(), bPU, p, env, 0, pred, limits, bPU.getGeom());

</code></pre>

<p>La différence avec le code d'exemple de base tient en deux lignes :</p>
<ul>
<li>la récupération des limites le long desquelles les boîtes seront alignées ;</li>
<li>l'utilisation du simulateur spécifique aux boîtes alignées (classe <em>fr.ign.cogit.simplu3d.rjmcmc.cuboid.optimizer.paralellcuboid.ParallelCuboidOptimizer</em>)</li>
</ul>
<p>Le résultat est celui de la figure suivante. On visualise bien que la boîtes est alignée avec la limite séparative ce qui fait que le résultat optimisé n'occupe pas l'intérieur du L.</p>
<p><img alt="Résult de la simulation d'une boîte alignée" src="../img/alignedBox.png" /></p>
<h2 id="definition-de-loptimiseur">Définition de l'optimiseur<a class="headerlink" href="#definition-de-loptimiseur" title="Permanent link"></a></h2>
<p>L'optimiseur est défini comme générant des objets de la classe  <em>fr.ign.cogit.simplu3d.rjmcmc.cuboid.geometry.simple.ParallelCuboid</em> du projet SimPLU3D composé de 4 dimensions. Néanmoins, cette classe possède les attributs orientation et width pour permettre de générer la forme de la boîte.</p>
<p>La différence principale avec la simulation du bâtiment en L se situe au niveau du builder (classe <em>fr.ign.cogit.simplu3d.rjmcmc.cuboid.builder.ParallelCuboidBuilder</em> du projet SimPLU3D). Le builder est défini comme ayant 4 dimensions mais il va bien renseigner les 6 dimensions de l'objet  <em>ParallelCuboid</em>.</p>
<p>Pour déterminer la largeur et l'orientation, une projection est effectuée depuis le point tiré aléatoirement vers la limite sur laquelle la forme est alignée. La longueur de la projection détermine la moitié de la largeur de la boîte et son azimut l'orientation de la boîte (cf code ci-dessous).</p>
<pre><code class="JAVA">@Override
public Cuboid build(double[] coordinates) {
  Coordinate p = new Coordinate(coordinates[0], coordinates[1]);
  DistanceOp op = new DistanceOp(this.limits, factory.createPoint(p));
  Coordinate projected = op.nearestPoints()[0];
  double distance = op.distance();
  double orientation = Angle.angle(p, projected);
  AbstractParallelCuboid result;
  if (bandType == 1) {

    result = new ParallelCuboid(coordinates[0], coordinates[1], coordinates[2], distance * 2,
        coordinates[3], orientation + Math.PI / 2);

  } else {
    result = new ParallelCuboid2(coordinates[0], coordinates[1], coordinates[2], distance * 2,
        coordinates[3], orientation + Math.PI / 2);
  }
  return result;
}
</code></pre>

<p>Tous les autres aspects (implémentation des noyaux de proposition et du sampler) sont définis de la même manière que vu précédemment mais adaptés pour ces objets à 4 dimensions.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../visitor/intro/" class="btn btn-neutral float-right" title="Intro">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../predicate/" class="btn btn-neutral" title="Predicate"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>IGNF 2018-2019</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/SimPLU3D/simplu3D-tutorial" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../predicate/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../visitor/intro/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>

</body>
</html>
