<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="MBrasebin">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Formats de règles - SimPLU3D tutorial</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Formats de r\u00e8gles";
    var mkdocs_page_input_path = "rules/formats.md";
    var mkdocs_page_url = "/simplu3D-tutorial/rules/formats/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> SimPLU3D tutorial</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Accueil</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Premiers pas</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../begin/intro/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../begin/installation/">Installation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../begin/first_simulation/">Première simulation</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../principe/intro/">Principe</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Environnement géographique</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../envgeo/intro/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../envgeo/modelgeo/">Modèle géographique détaillé</a>
                </li>
                <li class="">
                    
    <a class="" href="../../envgeo/integration/">Processus d'intégration</a>
                </li>
                <li class="">
                    
    <a class="" href="../../envgeo/integration-test/">Tester l'intégration</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Générateur de formes</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../generator/intro/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../generator/principe/">Principe de fonctionnement du générateur</a>
                </li>
                <li class="">
                    
    <a class="" href="../../generator/custom-generator/">Paramétrer la génération de boîtes</a>
                </li>
                <li class="">
                    
    <a class="" href="../../generator/custom-optimisation/">Personnaliser la fonction d'optimisation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../generator/custom-shape/">Personnaliser les formes utilisées</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Définition des contraintes morphologiques</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../intro/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../predicate/">Principe de fonctionnement du vérificateur</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Formats de règles</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#formats-de-stockage-des-regles">Formats de stockage des règles</a></li>
    

    <li class="toctree-l3"><a href="#integration-de-regles-sous-forme-dun-tableau">Intégration de règles sous forme d'un tableau</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#code-de-reglementation">Code de réglementation</a></li>
        
            <li><a class="toctree-l4" href="#code-de-simulation">Code de simulation</a></li>
        
        </ul>
    

    <li class="toctree-l3"><a href="#autres-exemples-dutilisation-de-fichier-de-regles">Autres exemples d'utilisation de fichier de règles</a></li>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../topologique/">Définition de contraintes topologiques</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../export/">Exporter les résultats d'une simulation</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../visitor/intro/">Suivre l'évolution d'une simulation</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../openmole/intro/">Distribuer avec OpenMole</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../development/">Futurs développements</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../about/">À propos</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../bibliographie/">Réalisations et bibliographie</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">SimPLU3D tutorial</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Définition des contraintes morphologiques &raquo;</li>
        
      
    
    <li>Formats de règles</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/SimPLU3D/simplu3D-tutorial?query=root/path/docs/rules/formats.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="formats-de-stockage-des-regles">Formats de stockage des règles<a class="headerlink" href="#formats-de-stockage-des-regles" title="Permanent link"></a></h1>
<p>SimPLU3D ne possède pas un format pour stocker les règles morphologiques. En effet, les différentes expériences ont montré que suivant les besoins, l'échelle d'étude et les réglementations locales, les règles nécessaires à modéliser pouvaient beaucoup varier. Ainsi, pour rester générique, c'est à l'utilisateur de définir comment stocker ces règles et implémenter l'interface <em>Predicate</em> en fonction de ces règles.</p>
<p>Cependant, dans cette partie nous présenterons d'abord un exemple de code avec une démarche conseillée pour intégrer des règles à partir d'un tableau. Puis, nous pointerons vers différentes expérimentations utilisant différents formats de règles.</p>
<h1 id="integration-de-regles-sous-forme-dun-tableau">Intégration de règles sous forme d'un tableau<a class="headerlink" href="#integration-de-regles-sous-forme-dun-tableau" title="Permanent link"></a></h1>
<p>Ici, nous présenterons un exemple pour charger des règles stockées dans un fichier .csv et pour appliquer ces règles aux différentes zones d'un plan de zonage via le <em>SamplerPredicate</em> . Le code est disponible dans la classe <em>fr.ign.simplu3d.simulRules.SimulWithRules</em> du projet SimPLU3D-tutorial. Les données utilisées sont stockées dans le dossier <em>resources/simulationWithRules</em> qui contient notamment un fichier <em>rules.csv</em> en plus (mis en tableau ci dessous). La jointure entre les zones urbaines et les valeurs de ce tableau s'effectue via le champ <em>libelle</em>.</p>
<table>
<thead>
<tr>
<th align="left">libelle</th>
<th align="left">distReculVoirie</th>
<th align="left">distReculFond</th>
<th align="left">distReculLat</th>
<th align="left">distanceInterBati</th>
<th align="left">maximalCES</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">ub1</td>
<td align="left">2</td>
<td align="left">3</td>
<td align="left">4</td>
<td align="left">8</td>
<td align="left">0.5</td>
</tr>
<tr>
<td align="left">ub2</td>
<td align="left">4</td>
<td align="left">5</td>
<td align="left">4</td>
<td align="left">8</td>
<td align="left">1</td>
</tr>
</tbody>
</table>
<p>Le résultat de la simulation est visible ci dessous, seules 2 parcelles sont simulées (celles avec 1 comme valeur pour l'attribut SIMUL)</p>
<p><img alt="Résultat de la simulation" src="../img/resultSimulation.png" /></p>
<h2 id="code-de-reglementation">Code de réglementation<a class="headerlink" href="#code-de-reglementation" title="Permanent link"></a></h2>
<p>Au préalable, une classe de réglementation a été créée (<em>fr.ign.simplu3d.simulRules.RegulationTuto</em>). Cette classe implémente l'interface <em>IZoneRegulation</em> qui permet de rattacher une réglementation à une zone (classe <em>UrbaZone</em>). Cette interface a déjà été vue dans la section présentant le <a href="../../envgeo/modelgeo/">modèle géographique</a>.</p>
<p>Il s'agit d'une simple classe ayant des accesseurs aux différents paramètres du règlement ainsi qu'à son libellé.</p>
<h2 id="code-de-simulation">Code de simulation<a class="headerlink" href="#code-de-simulation" title="Permanent link"></a></h2>
<p>Le code de simulation ressemble à celui présenté dans la simulation de base avec quelques modifications. La plus importante différence concerne la méthode <em>readAndAssociateRules</em> qui parse le fichier rules.csv contenant les règles et créé le lien entre les différentes zones urbaines et les instances des différents règlements.</p>
<pre><code class="JAVA">public static void readAndAssociateRules(String ruleFile, Environnement env) throws Exception {
  // Creation of a map to create a link between id regulation and regulation
  Map&lt;String, RegulationTuto&gt; mapLibelleRegulation = new HashMap&lt;&gt;();

  ////////////////////
  //// READING THE CSV FILE to complete the map
  ////////////////////

  BufferedReader in = new BufferedReader(new FileReader(new File(ruleFile)));

  // The first line is the head
  in.readLine();
  String line = &quot;&quot;;
  // For each line
  while ((line = in.readLine()) != null) {

    // We create a new regulation
    RegulationTuto r = new RegulationTuto(line);
    // We add it to the map with it is name
    if (r != null) {
      mapLibelleRegulation.put(r.getLibelle(), r);
    }

  }

  in.close();

  ////////////////////
  //// ASSOCIATING UrbaZone and regulation
  ////////////////////

  for (UrbaZone zone : env.getUrbaZones()) {
    // We use the libelle to make a join between regulation and zone
    RegulationTuto regulation = mapLibelleRegulation.get(zone.getLibelle());

    // We create the link in the two directions for convenience
    zone.setZoneRegulation(regulation);
    if (regulation != null) {
      regulation.setUrbaZone(zone);

    }

  }

}
</code></pre>

<p>On peut également noter par ailleurs l'utilisation de la méthode <strong>hasToBeSimulated</strong> pour ne simuler que les parcelles ayant 1 comme valeur dans le champs <strong>simul</strong> du fichier contenant les parcelles.</p>
<pre><code class="JAVA">if (!currentCadastralParcel.hasToBeSimulated()) {
 continue;
}
</code></pre>

<p>Dans cet exemple, il n'y a qu'une seule sous-parcelle par parcelle (c'est-à-dire que chaque parcelle est complètement incluse dans une seule zone urbaine). Néanmoins, il est possible de considérer plusieurs règlements au sein d'une parcelle et d'accéder à ces règlements via les sous-parcelles. Cela nécessite dans le prédicat de vérifier pour chacun des objets à quelle(s) sous-parcelle(s) il appartient et à appliquer les vérifications en fonction de ces règlements. Une seconde complexité est de proposer une méthode pour réconcilier ces différents règlements (Par exemple, comme mesure-t-on une contrainte de distance entre 2 objets qui se trouvent dans 2 zones différentes ?). Cet aspect est compliqué à formaliser, mais un exemple est défini dans la classe <a href="https://github.com/ArtiScales/ArtiScales/blob/master/src/main/java/fr/ign/cogit/rules/predicate/MultiplePredicateArtiScales.java">MultiplePredicateArtiScales du projet ArtiScales</a>.</p>
<h1 id="autres-exemples-dutilisation-de-fichier-de-regles">Autres exemples d'utilisation de fichier de règles<a class="headerlink" href="#autres-exemples-dutilisation-de-fichier-de-regles" title="Permanent link"></a></h1>
<p>Deux types de formats de règles ont été utilisés :</p>
<ul>
<li>
<p><strong>Format OCL</strong>(Object Constraint Language) : le format OCL permet de modéliser des contraintes à partir d'instances d'un modèle. Ainsi, l'utilisation de règles au format OCL permet une grande expressivité comme il peut utiliser et combiner tous les concepts du modèle géographique de SimPLU3D. Cependant, cette expressivité a un coût car le temps d'évaluation d'une contrainte formulée en OCL est beaucoup plus longue que son équivalent programmée en Java. Pour en savoir plus, vous pouvez consulter la page Github de <a href="https://github.com/SimPLU3D/simplu3D-ocl/blob/master/README.md">SimPLU3D-OCL</a> ;</p>
</li>
<li>
<p><strong>Format CartoPLU+</strong> : le format CartoPLU+ stocke les règles sous format d'un tableau CSV à partir d'une sélection de contraintes effectuée par l'<a href="https://www.iau-idf.fr/">IAUIDF</a> et la <a href="http://www.driea.ile-de-france.developpement-durable.gouv.fr/">DRIEA</a>. Pour en savoir plus, vous pouvez consulter la page Github du projet <a href="https://github.com/SimPLU3D/simplu3D-iauidf">SimPLU3D-IAUIDF</a>.</p>
</li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../topologique/" class="btn btn-neutral float-right" title="Définition de contraintes topologiques">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../predicate/" class="btn btn-neutral" title="Principe de fonctionnement du vérificateur"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>IGNF 2018-2019</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/SimPLU3D/simplu3D-tutorial" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../predicate/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../topologique/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
