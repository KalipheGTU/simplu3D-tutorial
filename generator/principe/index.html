<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="MBrasebin">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Principe - SimPLU3D tutorial</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Principe";
    var mkdocs_page_input_path = "generator/principe.md";
    var mkdocs_page_url = "/generator/principe/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> SimPLU3D tutorial</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../about/">About</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../bibliographie/">Bibliographie</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../development/">Development</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../export/">Export</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Begin</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../begin/first_simulation/">First simulation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../begin/installation/">Installation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../begin/intro/">Intro</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Envgeo</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../envgeo/integration-test/">Integration test</a>
                </li>
                <li class="">
                    
    <a class="" href="../../envgeo/integration/">Integration</a>
                </li>
                <li class="">
                    
    <a class="" href="../../envgeo/intro/">Intro</a>
                </li>
                <li class="">
                    
    <a class="" href="../../envgeo/modelgeo/">Modelgeo</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Generator</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../custom-generator/">Custom generator</a>
                </li>
                <li class="">
                    
    <a class="" href="../custom-optimisation/">Custom optimisation</a>
                </li>
                <li class="">
                    
    <a class="" href="../custom-shape/">Custom shape</a>
                </li>
                <li class="">
                    
    <a class="" href="../intro/">Intro</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Principe</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#principe-du-fonctionnement-du-generateur-de-formes">Principe du fonctionnement du générateur de formes</a></li>
    

    <li class="toctree-l3"><a href="#configuration-batie">Configuration bâtie</a></li>
    

    <li class="toctree-l3"><a href="#generation-de-configurations-baties">Génération de configurations bâties</a></li>
    

    <li class="toctree-l3"><a href="#deroulement-de-lalgorithme">Déroulement de l'algorithme</a></li>
    

    <li class="toctree-l3"><a href="#implementation-de-lalgorithme">Implémentation de l'algorithme</a></li>
    

    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Openmole</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../openmole/intro/">Intro</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Principe</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../principe/intro/">Intro</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Rules</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../rules/formats/">Formats</a>
                </li>
                <li class="">
                    
    <a class="" href="../../rules/intro/">Intro</a>
                </li>
                <li class="">
                    
    <a class="" href="../../rules/predicate/">Predicate</a>
                </li>
                <li class="">
                    
    <a class="" href="../../rules/topologique/">Topologique</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Visitor</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../visitor/intro/">Intro</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">SimPLU3D tutorial</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Generator &raquo;</li>
        
      
    
    <li>Principe</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/SimPLU3D/simplu3D-tutorial/generator/principe.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <hr />
<h1 id="principe-du-fonctionnement-du-generateur-de-formes">Principe du fonctionnement du générateur de formes<a class="headerlink" href="#principe-du-fonctionnement-du-generateur-de-formes" title="Permanent link"></a></h1>
<p>Dans cette partie nous introduirons les différents aspects concernant la génération de formes dans SimPLU3D et la manière avec laquelle l'algorithme du recuit-simulé est utilisé.</p>
<h1 id="configuration-batie">Configuration bâtie<a class="headerlink" href="#configuration-batie" title="Permanent link"></a></h1>
<p>Dans SimPLU3D, une configuration bâtie est composée d'un ensemble de géométries paramétriques. Une géométrie est dite paramétrique quand on peut la décrire à travers un vecteur de dimension constante. Dans la plupart des expérimentations de SimPLU3D, comme dans l'exemple de la première simulation, les géométries paramétriques manipulées sont des boîtes. Dans ce cas, s'agit d'une géométrie de 6 dimensions décrite par le vecteur <strong>b</strong> = (<strong>x</strong>, <strong>y</strong>, <strong>l</strong>, <strong>w</strong>, <strong>h</strong>, <strong>θ</strong>). Néanmoins, il est tout à fait possible d'utiliser d'autres types de géométries paramétriques comme nous le verrons dans la section sur la <a href="../custom-generator/">personnalisation des formes générées</a>.</p>
<p><img alt="Image représentant une boîte" src="../img/boite.png" /></p>
<h1 id="generation-de-configurations-baties">Génération de configurations bâties<a class="headerlink" href="#generation-de-configurations-baties" title="Permanent link"></a></h1>
<p>La génération de formes bâties avec SimPLU3D se base sur la technique du recuit-simulé transdimensionnel. Le recuit simulé est une technique d'optimisation et le fait que l'approche soit transdimensionnel indique que c'est le système qui détermine le nombre d'objets nécessaires pour atteindre l'objectif.</p>
<p>Ainsi, si on considère une fonction d'optimisation <strong>f</strong>, comme le volume, le recuit simulé détermine les <strong>n</strong> boîtes et leurs paramètres qui permettent de produire la configuration bâtie la plus volumineuse possible.</p>
<p><img alt="Image représentant une boîte" src="../img/configuration.png" /></p>
<h1 id="deroulement-de-lalgorithme">Déroulement de l'algorithme<a class="headerlink" href="#deroulement-de-lalgorithme" title="Permanent link"></a></h1>
<p><img alt="Image montrant le principe" src="../img/principe.png" /></p>
<p>L'algorithme est un algorithme itératif. À chaque itération, on considère une configuration bâtie courante. Le système choisit une modification parmi les noyaux de proposition de modification disponibles (dans l'exemple, le noyau d'ajout est sélectionné pour ajouter une nouvelle boîte). Ensuite, une probabilité d'acception est déterminée suivant la théorie du recuit simulée. Elle prend en compte les scores des configurations avant et après modification et la température courante (il s'agit d'une valeur qui décroît au fur et à mesure des itérations). Ainsi, il existe une certaine probabilité pour que cette modification soit rejetée (1 - α(t,s,s’)) et une certaine probabilité pour que la modification soit acceptée (α(t,s,s’)). Si la configuration est acceptée, on s'assure qu'elle respecte les règles morphologiques, si c'est le cas elle remplace la configuration courante sinon la modification est rejetée.</p>
<h1 id="implementation-de-lalgorithme">Implémentation de l'algorithme<a class="headerlink" href="#implementation-de-lalgorithme" title="Permanent link"></a></h1>
<p>L'implémentation de l'algorithme est effectuée grâce à la bibliothèque générique et OpenSource <a href="https://github.com/IGNF/librjmcmc4j">librjmcmc4j</a>. Pour en savoir plus, vous pouvez consulter l'article :</p>
<blockquote>
<p><em>Brédif, M., Tournaire, O.</em>, Aug. 2012. librjmcmc: An open-source generic c++ library for stochastic optimization. In: The XXII Congress of the International Society of Photogrammetry and Remote Sensing. (<a href="https://www.int-arch-photogramm-remote-sens-spatial-inf-sci.net/XXXIX-B3/259/2012/isprsarchives-XXXIX-B3-259-2012.pdf">https://www.int-arch-photogramm-remote-sens-spatial-inf-sci.net/XXXIX-B3/259/2012/isprsarchives-XXXIX-B3-259-2012.pdf</a>)</p>
</blockquote>
<p>Dans l'exemple de la <a href="../../begin/first_simulation/">première simulation</a>, les étapes de l'algorithme, présentés dans le schéma précédent, s'effectue dans la méthode <em>process()</em> de la classe <em>OptimisedBuildingsCuboidFinalDirectRejection</em>. L'algorithme peut se décomposer en 3 phases :</p>
<ul>
<li><strong>Étape 1</strong> : <a href="../custom-generator/">la définition des configurations bâties et des modifications appliquées</a>, ce qui correspond aux boîtes "Classe de géométrie paramétrique" et "Noyaux de propositions" du schéma ;</li>
<li><strong>Étape 2</strong> : <a href="../custom-optimisation/">la définition des paramètres de l'algorithme en lui-même</a>, c'est à-dire la fonction d'optimisation et les conditions initiales et d'arrêt ;</li>
<li><strong>Étape 3</strong> : <a href="../../visitor/intro/">la mise en place de visiteurs</a>, c'est à dire d'objets qui produiront des sorties au fur et à mesure de la simulation. Ils sont présentés dans une autre section mais n'influent pas sur le processus d'optimisation) ;</li>
<li><strong>Étape 4</strong> : l'exécution de la simulation.</li>
</ul>
<pre><code class="JAVA">/**
 * Process the generation of the optimization
 * @param bpu                    Basic property unit
 * @param geom                   The geometry in which the centroid of the
 *                               cuboids will be generated
 * @param p                      the parameters
 * @param env                    the environement
 * @param id                     the id of the experiments
 * @param pred                   the rules to check
 * @return a set of cuboid as a graph
 */
public GraphConfiguration&lt;Cuboid&gt; process(BasicPropertyUnit bpu, IGeometry geom, SimpluParameters p,
    Environnement env, int id,
    ConfigurationModificationPredicate&lt;GraphConfiguration&lt;Cuboid&gt;, BirthDeathModification&lt;Cuboid&gt;&gt; pred,
    List&lt;Visitor&lt;GraphConfiguration&lt;Cuboid&gt;, BirthDeathModification&lt;Cuboid&gt;&gt;&gt; lSupplementaryVisitors) {

    //Step 1 :

    // Sampler creation (definition of the class and of the kernel modifications)
    // Création de l'échantilloneeur (définition de la classe et des noyaux de modifications)
    Sampler&lt;GraphConfiguration&lt;Cuboid&gt;, BirthDeathModification&lt;Cuboid&gt;&gt; samp = create_sampler(Random.random(), p,
    bpu, pred, geom);

    //Step 2 : Preparation of the optimizer
    //Étape 2 : Préparation de l'optimiseur

    //Initializing the configuration (optimisation function + set of cuboid)
    //Initizialization de la configuration (fonction d'optimisation + stock les cuboids de la configuration courante
    GraphConfiguration&lt;Cuboid&gt; conf = null;
    try {
      conf = create_configuration(p, AdapterFactory.toGeometry(new GeometryFactory(), bpu.getGeom()), bpu);
    } catch (Exception e) {
      e.printStackTrace();
    }

    // Temperature initialization
    //Initialization de la fonction de la température
    Schedule&lt;SimpleTemperature&gt; sch = create_schedule(p);


    //The end test condition
    end = create_end_test(p);

    //Step 3 : Visitor instanciation
    //Étape 3 : Préparation des visiteurs

    //The visitors initialisation
    PrepareVisitors&lt;Cuboid&gt; pv = new PrepareVisitors&lt;&gt;(env, lSupplementaryVisitors);
    CompositeVisitor&lt;GraphConfiguration&lt;Cuboid&gt;, BirthDeathModification&lt;Cuboid&gt;&gt; mVisitor = pv.prepare(p, id);

    //Step 4 : Running the optimization process
    //Étape 4 : Exécution de l'optimization
    SimulatedAnnealing.optimize(Random.random(), conf, samp, sch, end, mVisitor);
    return conf;
}
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../openmole/intro/" class="btn btn-neutral float-right" title="Intro">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../intro/" class="btn btn-neutral" title="Intro"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>IGNF 2018-2019</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/SimPLU3D/simplu3D-tutorial" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../intro/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../openmole/intro/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>

</body>
</html>
