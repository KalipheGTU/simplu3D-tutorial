<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="MBrasebin">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Premiers pas - Première simulation - SimPLU3D tutorial</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Premiers pas - Premi\u00e8re simulation";
    var mkdocs_page_input_path = "begin/first_simulation.md";
    var mkdocs_page_url = "/simplu3D-tutorial/begin/first_simulation/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> SimPLU3D tutorial</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Accueil</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Premiers pas</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../intro">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../installation">Installation</a>
                </li>
                <li class="">
                    
    <a class="" href=".">Première simulation</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../principe/intro">Principe</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Environnement géographique</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../envgeo/intro">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../envgeo/modelgeo">Modèle géographique détaillé</a>
                </li>
                <li class="">
                    
    <a class="" href="../../envgeo/integration">Processus d'intégration</a>
                </li>
                <li class="">
                    
    <a class="" href="../../envgeo/integration-test">Tester l'intégration</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Générateur de formes</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../generator/intro">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../generator/principe">Principe de fonctionnement du générateur</a>
                </li>
                <li class="">
                    
    <a class="" href="../../generator/custom-generator">Paramétrer la génération de cuboids</a>
                </li>
                <li class="">
                    
    <a class="" href="../../generator/custom-generator">Personnaliser la fonction d'optimisation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../generator/custom-shape">Personnaliser les formes utilisées</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Définition des contraintes morphologiques</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../rules/intro">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../rules/predicate/">Principe de fonctionnement du vérificateur</a>
                </li>
                <li class="">
                    
    <a class="" href="../../rules/formats">Formats de règles</a>
                </li>
                <li class="">
                    
    <a class="" href="../../rules/topologique">Définition de contraintes topologiques</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../export/">Exporter les résultats d'une simulation</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../visitor/intro">Suivre l'évolution d'une simulation</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../openmole/intro">Distribuer avec OpenMole</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../development/">Futurs développements</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../about/">À propos</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../bibliographie/">Réalisations et bibliographie</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">SimPLU3D tutorial</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
    
    <li>Premiers pas - Première simulation</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/SimPLU3D/simplu3D-tutorial?query=root/path/docs/begin/first_simulation.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link"></a></h1>
<p>L'objectif de cette page est de lancer une première simulation très simple afin de voir comment se déroule une simulation de SimPLU3D. Cette simulation consiste à générer une forme composé de boites qui s'intersectent à partir d'un code exemple qui sera enrichi au fur et à mesure de cette documentation. Pour commencer, il est nécessaire  d'installer les codes de tutoriel comme précisé dans la <a href="../installation/">page d'installation</a>.</p>
<p>Le code utilisé dans cette page est dans la classe :  <em>fr.ign.simplu3d.firstSimulation.BasicSimulator</em>.</p>
<h1 id="donnees-dentree">Données d'entrée<a class="headerlink" href="#donnees-dentree" title="Permanent link"></a></h1>
<p>Les données en entrée se trouvent dans le répertoire de ressources <em>resources/firstSimulation/</em>. Il s'agit du plus petit ensemble de données possible nécessaire pour exécuter SimPLU3D. Il contient deux dossiers :
- <strong>data</strong>: qui contient un fichier ShapeFile de parcelles (parcelle.shp) avec un attribut <strong>id</strong>. Ces parcelles définissent l'environnement géographique dans lequel se déroule la simulation, cet environnement géographique peut être enrichi d'autres objets déjà prévus dans SimPLU3D (vous trouverez plus d'informations dans <a href="/../envgeo/intro.md">la section consacré à l'environnement géographique</a>) ;
- <strong>scenario</strong> : qui contient un fichier params.json qui contient la description des paramètres de la génération de forme (décrits dans la section dédiée aux <a href="../../generator/custom-generator/">paramètres de la génération de formes</a>) et des visiteurs qui seront exécutés pendant la simulation (<a href="../Visitor/intro.md">décrits dans la section dédiée aux visiteurs</a>).</p>
<p><img alt="Carte des données en entrée" src="../img/data-in-simu0.png" /></p>
<h1 id="code-de-simulation">Code de simulation<a class="headerlink" href="#code-de-simulation" title="Permanent link"></a></h1>
<p>Le code à exécuter est repris ci-dessous commenté. On note qu'il y a 4 étapes nécessaires pour exécuter la simulation :</p>
<ol>
<li>la création d'un <a href="/../envgeo/intro.md">environnement géographique</a> ;</li>
<li>la définition de <a href="/../rules/intro.md">contraintes morphologiques</a>, à partir d'une classe de vérification de règles déjà implémentée ;</li>
<li>la définition d'un <a href="/../generator/intro.md">générateur de formes</a>, basé sur des boites ;</li>
<li>l'<a href="export.md">export de résultats</a>.</li>
</ol>
<pre><code class="Java">public static void main(String[] args) throws Exception {

  //Step 0 ; Defining an output existing folder
  String outputFolder = &quot;/tmp/&quot;;

  // Step 1 : Creating the geographic environnement using the repository that contains the data

  // Load default environment (data are in resource directory)
  Environnement env = LoaderSHP.loadNoDTM(
      new File(BasicSimulator.class.getClassLoader().getResource(&quot;firstSimulation/data/&quot;).getPath()));

  // Select a parcel on which generation is proceeded
  BasicPropertyUnit bPU = env.getBpU().get(2);

  //Step 2 : Defining the regulation that will be applied during the simulation

  // Rules parameters.8
  // Distance to road
  double distReculVoirie = 2;
  // Distance to bottom of the parcel
  double distReculFond = 3;
  // Distance to lateral parcel limits
  double distReculLat = 4;
  // Distance between two buildings of a parcel
  double distanceInterBati = 0;
  // Maximal ratio built area
  double maximalCES = 0.5;

  //Instanciation of a predicate class
  SamplePredicate&lt;Cuboid, GraphConfiguration&lt;Cuboid&gt;, BirthDeathModification&lt;Cuboid&gt;&gt; pred = new SamplePredicate&lt;&gt;(
      bPU, distReculVoirie, distReculFond, distReculLat, distanceInterBati, maximalCES);



  //Step 3 : Defining the regulation that will be applied during the simulation


  // Instantiation of the sampler
  OptimisedBuildingsCuboidFinalDirectRejection oCB = new OptimisedBuildingsCuboidFinalDirectRejection();


  // Loading the parameters for the building shape generation
  String folderName = BasicSimulator.class.getClassLoader().getResource(&quot;firstSimulation/scenario/&quot;).getPath();
  String fileName = &quot;params.json&quot;;
  SimpluParameters p = new SimpluParametersJSON(new File(folderName + fileName));


  // Run of the optimisation on a parcel with the predicate
  GraphConfiguration&lt;Cuboid&gt; cc = oCB.process(bPU, p, env, 1, pred);

  //4 - Writting the output
  SaveGeneratedObjects.saveShapefile(outputFolder + &quot;out.shp&quot;, cc, bPU.getId(), 0);

}
</code></pre>

<h1 id="execution-du-code-de-simulation">Exécution du code de simulation<a class="headerlink" href="#execution-du-code-de-simulation" title="Permanent link"></a></h1>
<p>Avant d'exécuter ce code, il est nécessaire de définir la variable outputFolder qui détermine le dossier dans lequel les résultats de la simulation seront exportés.</p>
<p>Une fois cette valeur fixée, vous pouvez exécuter le code.</p>
<p>Pendant le code, des informations sur l'avancement de la simulation seront affichées (pour en savoir plus la section <a href="../../visitor/intro/">suivre l'évolution d'une simulation</a>).
Deux sorties sont visualisables pendant la simulation :
- Dans la console, un tableau représente durant les itérations des informations relatives à la simulation et notamment le nombre d'objets et la valeur de la fonction d'optimisation ;
- Dans une fenêtre, la valeur de la fonction d'optimisation (en rouge foncé) évolue au fur et à mesure des itérations. Dans ce cas, la valeur représentée est - le volume de la configuration (l'algorithme d'optimisation utilisé minimisant la valeur d'une fonction d'optimisation, c'est pour cela que la valeur évolue en diminuant).</p>
<p><img alt="Image des visiteurs pendant la simulation" src="../img/duringsimulation.png" /></p>
<h1 id="resultats-de-la-premiere-simulation">Résultats de la première simulation<a class="headerlink" href="#resultats-de-la-premiere-simulation" title="Permanent link"></a></h1>
<p>La sortie est stockée sous la forme d'un ShapeFile <em>out.shp</em> qui contient les différentes boites avec des attributs :</p>
<ul>
<li><strong>id</strong> : l'identifiant de la parcelle simulée ;</li>
<li><strong>hauteur</strong> : la hauteur de la boite ;</li>
<li><strong>longueur</strong> : la longueur de la boite ;</li>
<li><strong>largeur</strong> : la largeur de la boite ;</li>
<li><strong>orient</strong> : l'azimut de la boite ;</li>
<li><strong>centerX</strong>, <strong>centerY</strong> : les coordonnées du centre de la boite.</li>
</ul>
<p>La géométrie est une géométrie 3D stockée sous la forme d'un multipolygoneZ.</p>
<p><img alt="Image présentant le résultat d'une simulation" src="../img/results-simu-0.png" /></p>
<p>Vous pouvez essayer de modifier le code pour tester les résultats sur différentes parcelles ou différentes variables de règles. <a href="../../principe/intro/">Dans la section suivante</a>, nous détaillons le principe de fonctionnement de la simulation.</p>
<p>Le résultat est visualisable dans un SIG 2D ou 3D classique.</p>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>IGNF 2018-2019</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/SimPLU3D/simplu3D-tutorial" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
