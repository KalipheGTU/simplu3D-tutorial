<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="MBrasebin">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Suivre l'évolution d'une simulation - SimPLU3D tutorial</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Suivre l'\u00e9volution d'une simulation";
    var mkdocs_page_input_path = "visitor/intro.md";
    var mkdocs_page_url = "/simplu3D-tutorial/visitor/intro/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> SimPLU3D tutorial</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Accueil</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Premiers pas</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../begin/intro/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../begin/installation/">Installation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../begin/first_simulation/">Première simulation</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../principe/intro/">Principe</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Environnement géographique</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../envgeo/intro/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../envgeo/modelgeo/">Modèle géographique détaillé</a>
                </li>
                <li class="">
                    
    <a class="" href="../../envgeo/integration/">Processus d'intégration</a>
                </li>
                <li class="">
                    
    <a class="" href="../../envgeo/integration-test/">Tester l'intégration</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Générateur de formes</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../generator/intro/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../generator/principe/">Principe de fonctionnement du générateur</a>
                </li>
                <li class="">
                    
    <a class="" href="../../generator/custom-generator/">Paramétrer la génération de cuboids</a>
                </li>
                <li class="">
                    
    <a class="" href="../../generator/custom-optimisation/">Personnaliser la fonction d'optimisation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../generator/custom-shape/">Personnaliser les formes utilisées</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Définition des contraintes morphologiques</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../rules/intro/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../rules/predicate/">Principe de fonctionnement du vérificateur</a>
                </li>
                <li class="">
                    
    <a class="" href="../../rules/formats/">Formats de règles</a>
                </li>
                <li class="">
                    
    <a class="" href="../../rules/topologique/">Définition de contraintes topologiques</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../export/">Exporter les résultats d'une simulation</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">Suivre l'évolution d'une simulation</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#principe-des-visiteurs">Principe des visiteurs</a></li>
    

    <li class="toctree-l2"><a href="#visiteurs-de-simplu3d">Visiteurs de SimPLU3D</a></li>
    

    <li class="toctree-l2"><a href="#sortie-console-outputstreamvisitor">Sortie console : OutPutStreamVisitor</a></li>
    

    <li class="toctree-l2"><a href="#sortie-shapefile-shapefilevisitor">Sortie shapefile : ShapefileVisitor</a></li>
    

    <li class="toctree-l2"><a href="#sortie-sous-forme-de-graphique-statsvisitor">Sortie sous forme de graphique : StatsVisitor</a></li>
    

    <li class="toctree-l2"><a href="#sortie-csv-csvvisitor-et-csvendstats">Sortie CSV : CSVvisitor et CSVendStats</a></li>
    

    <li class="toctree-l2"><a href="#visualisation-3d-a-la-volee-des-resultats-viewervisitor">Visualisation 3D à la volée des résultats : ViewerVisitor</a></li>
    

    <li class="toctree-l2"><a href="#export-dimage-a-la-volee-filmvisitor">Export d'image à la volée : FilmVisitor</a></li>
    

    <li class="toctree-l2"><a href="#utilisation-dautres-visiteurs">Utilisation d'autres visiteurs</a></li>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../openmole/intro/">Distribuer avec OpenMole</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../development/">Futurs développements</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../about/">À propos</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../bibliographie/">Réalisations et bibliographie</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">SimPLU3D tutorial</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
    
    <li>Suivre l'évolution d'une simulation</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/SimPLU3D/simplu3D-tutorial?query=root/path/docs/visitor/intro.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="principe-des-visiteurs">Principe des visiteurs<a class="headerlink" href="#principe-des-visiteurs" title="Permanent link"></a></h1>
<p>Les visiteurs sont des objets qui permettent de suivre l'évolution d'une simulation en produisant régulièrement des sorties. Les visiteurs implémentent l'interface de la libjrmcmc4j <em>Visitor<C extends Configuration<C, M>, M extends Modification<C, M>&gt;</em>. Pour un visiteur, il est possible de définir deux types de sorties :</p>
<ul>
<li><strong>les dumps</strong>, qui sont des sorties rapides en termes d'exécution qui sont effectuées fréquemment ;</li>
<li><strong>les saves</strong>, qui sont des sorties plus lentes en termes d'exécution et qui sont effectuées moins fréquemment.</li>
</ul>
<p>L'interface impose l'implémentation de 4 méthodes :</p>
<ul>
<li><strong>init(int dump, int save)</strong> :  initialisation du visiteur avant la simulation (notamment avec l'affectation des valeurs dump et save qui correspondent à la fréquence de production ds sorties dump et save);</li>
<li><strong>begin(C config, Sampler<C,M> sampler, Temperature t);</strong> : cette méthode qui est exécutée au début de la simulation ;</li>
<li><strong>visit(C config, Sampler<C,M> sampler, Temperature t);</strong> : cette méthode est exécutée à chaque itération, c'est ici que l'on distinguera les opérations de save et de dump avec par exemple un test de ce type :  <em>if ((save &gt; 0) &amp;&amp; (iter % save == 0)) {</em>;</li>
<li><strong>end(C config, Sampler<C,M> sampler, Temperature t);</strong> : cette méthode est appliquée lors de la toute dernière itération de la simulation.</li>
</ul>
<p>Dans le cadre de l'utilisation de SimPLU3D, plusieurs visiteurs ont été implémentés et sont activables et paramétrables via le fichier <em>params.json</em>. Les valeurs <strong>save</strong> et <strong>dump</strong> peuvent notamment y être définis pour tous les visiteurs. Vous pouvez tester ces visiteurs avec la simulation de base et pour toutes les autres. Les paramètres ont été correctement fixés, il suffit seulement de les activer et de mettre à jour le paramètre <em>save</em> et <em>background_img</em>.</p>
<h1 id="visiteurs-de-simplu3d">Visiteurs de SimPLU3D<a class="headerlink" href="#visiteurs-de-simplu3d" title="Permanent link"></a></h1>
<h1 id="sortie-console-outputstreamvisitor">Sortie console : OutPutStreamVisitor<a class="headerlink" href="#sortie-console-outputstreamvisitor" title="Permanent link"></a></h1>
<p>L'<strong>OutPutStreamVisitor</strong> est le visiteur qui affiche dans la console l'état d'avancement des simulations. Il est activable par la valeur <em>outputstreamvisitor</em>.</p>
<table>
<thead>
<tr>
<th align="left">Nom de la colonne</th>
<th align="left">Decription</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Iteration</td>
<td align="left">Numéro de l'itération courante</td>
</tr>
<tr>
<td align="left">Objects</td>
<td align="left">Nombre d'objets dans la configuration courante</td>
</tr>
<tr>
<td align="left">A - Nom de noyau</td>
<td align="left">Probabilité moyenne (sur les <em>dump</em> dernière itérations) que le noyau concerné soit choisi</td>
</tr>
<tr>
<td align="left">P - Nom du noyau</td>
<td align="left">Probabilité moyenne (sur les <em>dump</em> dernière itérations) que l'application de la modification du noyau soit acceptée</td>
</tr>
<tr>
<td align="left">Temp</td>
<td align="left">Valeur de la température</td>
</tr>
<tr>
<td align="left">Accept</td>
<td align="left">Probabilité moyenne (sur les <em>dump</em> dernière itérations) qu'une modification soit acceptée</td>
</tr>
<tr>
<td align="left">Time (ms)</td>
<td align="left">Temps d'exécution</td>
</tr>
<tr>
<td align="left">u_1</td>
<td align="left">Valeur de l'énergie unaire</td>
</tr>
<tr>
<td align="left">u_2</td>
<td align="left">Valeur de l'énergie binaire</td>
</tr>
<tr>
<td align="left">u</td>
<td align="left">Valeur de l'énergie combinée</td>
</tr>
</tbody>
</table>
<h1 id="sortie-shapefile-shapefilevisitor">Sortie shapefile : ShapefileVisitor<a class="headerlink" href="#sortie-shapefile-shapefilevisitor" title="Permanent link"></a></h1>
<p>Le <strong>ShapefileVisitor</strong>  est le visiteur qui permet de sauvegarder des shapefiles toutes les <em>save</em> itération. Il est activables par la valeur <em>shapefilewriter</em>.</p>
<p>Il est nécessaire également de paramétrer la valeur <em>result</em> qui indique le dossier dans lequel les ShapeFiles seront exportés. Ils portent comme nom le numéro de l'itération et les objets sauvegardés auront comme attributs la valeur d'énergie et de la méthode <em>toString()</em>.</p>
<h1 id="sortie-sous-forme-de-graphique-statsvisitor">Sortie sous forme de graphique : StatsVisitor<a class="headerlink" href="#sortie-sous-forme-de-graphique-statsvisitor" title="Permanent link"></a></h1>
<p>Le <strong>StatsVisitor</strong> permet la représentation de l'évolution de l'énergie au cours de la simulation sous forme d'un graphique. Il est activable par la valeur <em>statsvisitor</em>.</p>
<p>Plusieurs informations sont représentées comme l'énergie unaire, l'énergie binaire, l'énergie de la meilleure configuration rencontré et l'énergie de la configuration actuel. L'image ci-dessous présente le graphique qui peut être visualisé.</p>
<p><img alt="Illustration du graphc de simulation" src="../img/Graphic.png" /></p>
<p><strong>Petite astuce</strong> : comme le résultat d'une simulation est la dernière configuration rencontrée, ce graphique est utile pour visualiser si le meilleur candidat rencontré est bien cette dernière configuration. Normalement, si le processus d'optimisation s'est bien déroulé, les courbes "Meilleur candidat" et "Énergie de la configuration actuelle" doivent être confondus en fin de simulation. Sinon, il peut s'avérer nécessaire  d'augmenter le nombre d'itérations, la température et le coefficient de décroissance.</p>
<h1 id="sortie-csv-csvvisitor-et-csvendstats">Sortie CSV : CSVvisitor et CSVendStats<a class="headerlink" href="#sortie-csv-csvvisitor-et-csvendstats" title="Permanent link"></a></h1>
<p>Deux visiteurs permettent l'export de sorties sous forme de CSV : <em>CSVvisitor</em> et <em>CSVendStats</em> activables respectivement avec les valeurs <em>csvvisitor</em> et <em>csvvisitorend</em>.</p>
<p>Dans les deux cas, la valeur de <em>result</em> détermine le dossier de stockage des fichiers qui s'appelleront <em>csvfilename</em> et <em>csvfilenamend</em>.</p>
<p>Le premier CSV contient une ligne par itération et stock des informations sur la configuration courante : numéro de l'itération, taille de la configuration, énergie de la configuration courante et énergie moyenne sur les <em>dump</em> dernières itérations.</p>
<p>Le second CSV contient les information de fin de simulation par parcelle (pratique lorsque l'on effectue des simulations sur de nombreuses parcelles) et notamment, le nombre d'itérations, le temps d'exécution, la taille de la configuration et l'énergie finale.</p>
<h1 id="visualisation-3d-a-la-volee-des-resultats-viewervisitor">Visualisation 3D à la volée des résultats : ViewerVisitor<a class="headerlink" href="#visualisation-3d-a-la-volee-des-resultats-viewervisitor" title="Permanent link"></a></h1>
<p>Le <em>ViewerVisitor</em> permet de visualiser en 3D les évolutions de la simulation en cours. Il est activable par la valeur <em>visitorviewer</em> et permet de représenter les données chargées et la simulation avec une mise à jour toutes les <em>dump</em> itérations.</p>
<p>Quelques options d'affichage sont disponibles, comme le fait d'activer un plan contenant une image fixe avec l'option <em>showbackground</em>. Il est nécessaire de fixer le chemin absolu vers l'image utilisée <em>background_img</em> (à mettre à jour comme le chemin est absolu) et l'altitude de ce plan (valeur <em>z</em>.). Les coordonnées de ce plan sont fixées par les valeurs <em>xminbg</em>, <em>yminbg</em>, <em>xmaxbg</em> et <em>ymaxbg</em>. Il est également possible de choisir la couleur du fond de scène avec les options <em>filmvisitorr</em>, <em>filmvisitorg</em> et <em>filmvisitorb":"180</em>.</p>
<p>Lors de l'utilisation de ce visiteur, la caméra se positionnera au centre de la scène.</p>
<blockquote>
<p><img alt="#f03c15" src="https://placehold.it/15/f03c15/000000?text=+" /> <strong>Attention</strong>: : pour ce visiteur, la visualisation 3D nécessite l'utilisation de la bibliothèque native de Java 3D (qui se trouve dans le projet). Il est nécessaire de passer à la VM l'argument suivant :</p>
<p><strong>-Djava.library.path=./lib/native_libraries/linux-amd64</strong>  </p>
<p>La ligne précédente est définie pour Linux 64 bits, au besoin, il faut remplacer linux-amd64 par windows-i586 (windows 32bits), windows-amd64 (windows 64bits) ou linux-i386 (linux 32bits) en fonction de l'OS utilisé.</p>
</blockquote>
<h1 id="export-dimage-a-la-volee-filmvisitor">Export d'image à la volée : FilmVisitor<a class="headerlink" href="#export-dimage-a-la-volee-filmvisitor" title="Permanent link"></a></h1>
<p>Le <em>FilmVisitor</em> permet d'exporter le rendu des simulations sous forme de .jpeg toutes les <em>dump</em> itérations. Si le <em>StatsVisitor</em> est activé, l'image de la simulation et l'image de ce visiteur se retrouvent conjointement exportées (cf image ci-dessous).</p>
<p><img alt="FilmVisitor exemple" src="../img/FilmVisitor.jpg" /></p>
<p>Les paramètres du <em>FilmVisitor</em> sont tout d'abord ceux du <em>ViewerVisitor</em>. Il est également nécessaire de définir la valeur <em>save</em> pour désigner le répertoire dans lequel les images seront exportées.</p>
<p>Il est également nécessaire de définir les coordonnées de la position de la caméra avec les coordonnées <em>filmvisitorx</em>, <em>filmvisitory</em> et <em>filmvisitorz</em>  et la direction dans laquelle regarde la caméra avec les coordonnées : <em>filmvisitorvecty</em>, <em>filmvisitorvectx</em> et <em>filmvisitorvectz</em>.</p>
<h1 id="utilisation-dautres-visiteurs">Utilisation d'autres visiteurs<a class="headerlink" href="#utilisation-dautres-visiteurs" title="Permanent link"></a></h1>
<p>Il est totalement possible d'implémenter d'autres visiteurs en étendant l'interface <em>Visitor<C extends Configuration<C, M>, M extends Modification<C, M>&gt;</em>. Pour les optimiseur déjà définis, la classe <em>fr.ign.cogit.simplu3d.rjmcmc.generic.visitor.PrepareVisitors</em> du projet SimPLU3D permet d'initialiser les visiteurs et d'en rajouter d'autres via la liste <em>lSupplementaryVisitors</em>.</p>
<p>Sinon, de manière générale les visiteurs sont passés en paramètre de la méthode qui lance l'optimisation <em>SimulatedAnnealing.optimize</em> qui prend un objet de la classe <em>CompositeVisitor</em> en paramètre. L'instanciation d'un <em>CompositeVisitor</em> ne requiert qu'une liste de visiteur comme montré dans le code ci-dessous.</p>
<pre><code class="JAVA">  List&lt;Visitor&lt;GraphConfiguration&lt;C&gt;, BirthDeathModification&lt;C&gt;&gt;&gt; list = new ArrayList&lt;&gt;();
  list.addAll(lSupplementaryVisitors);
    CompositeVisitor&lt;GraphConfiguration&lt;C&gt;, BirthDeathModification&lt;C&gt;&gt; mVisitor = new CompositeVisitor&lt;&gt;(list);
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../openmole/intro/" class="btn btn-neutral float-right" title="Distribuer avec OpenMole">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../export/" class="btn btn-neutral" title="Exporter les résultats d'une simulation"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>IGNF 2018-2019</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/SimPLU3D/simplu3D-tutorial" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../../export/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../openmole/intro/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
